<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlightDealz - Weekend Flight Deal Finder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #0066FF;
            --secondary-color: #0052CC;
            --accent-color: #FF4081;
            --success-color: #4CAF50;
            --warning-color: #FFC107;
            --danger-color: #F44336;
            --light-gray: #F5F7FA;
            --medium-gray: #E0E6ED;
            --dark-gray: #2C3E50;
            --text-color: #333;
            --shadow: 0 2px 4px rgba(0,0,0,0.1);
            --shadow-lg: 0 4px 6px rgba(0,0,0,0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--light-gray);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.5rem 0;
            box-shadow: var(--shadow);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo svg {
            width: 32px;
            height: 32px;
        }

        .tagline {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        /* Navigation */
        nav {
            background: white;
            border-bottom: 1px solid var(--medium-gray);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .nav-content {
            display: flex;
            gap: 1rem;
            padding: 1rem 0;
        }

        .nav-item {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            border: none;
            background: none;
            color: var(--text-color);
        }

        .nav-item:hover {
            background: var(--light-gray);
        }

        .nav-item.active {
            background: var(--primary-color);
            color: white;
        }

        /* Main Content */
        main {
            padding: 2rem 0;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--medium-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header h2 {
            font-size: 1.5rem;
            color: var(--dark-gray);
        }

        .card-body {
            padding: 1.5rem;
        }

        /* Deal Cards */
        .deals-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .deal-card {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .deal-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .deal-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1rem;
        }

        .deal-route {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .deal-dates {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .deal-body {
            padding: 1.5rem;
        }

        .deal-price {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .deal-savings {
            display: inline-block;
            background: var(--success-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
            margin-bottom: 1rem;
        }

        .deal-details {
            display: grid;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }

        .deal-detail {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--light-gray);
        }

        .deal-detail:last-child {
            border-bottom: none;
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary-color);
        }

        .btn-secondary {
            background: var(--medium-gray);
            color: var(--dark-gray);
        }

        .btn-secondary:hover {
            background: #d0d6dd;
        }

        .btn-block {
            width: 100%;
            justify-content: center;
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--dark-gray);
        }

        .form-control {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--medium-gray);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        /* Utility Classes */
        .text-center {
            text-align: center;
        }

        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mb-4 { margin-bottom: 2rem; }

        /* Autocomplete styles */
        .autocomplete-wrapper {
            position: relative;
        }

        .autocomplete-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid var(--medium-gray);
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            display: none;
            box-shadow: var(--shadow);
        }

        .autocomplete-suggestions.active {
            display: block;
        }

        .autocomplete-suggestion {
            padding: 0.75rem;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--light-gray);
        }

        .autocomplete-suggestion:last-child {
            border-bottom: none;
        }

        .autocomplete-suggestion:hover,
        .autocomplete-suggestion.selected {
            background: var(--light-gray);
        }

        .autocomplete-suggestion-main {
            display: flex;
            flex-direction: column;
        }

        .autocomplete-suggestion-name {
            font-weight: 500;
            color: var(--dark-gray);
        }

        .autocomplete-suggestion-city {
            font-size: 0.85rem;
            color: #666;
        }

        .autocomplete-suggestion-code {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        /* Filter Section */
        .filter-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Airport Multi-Select */
        .airport-select {
            border: 1px solid var(--medium-gray);
            border-radius: 8px;
            padding: 0.5rem;
            max-height: 200px;
            overflow-y: auto;
        }

        .airport-option {
            display: flex;
            align-items: center;
            padding: 0.5rem;
            cursor: pointer;
        }

        .airport-option:hover {
            background: var(--light-gray);
        }

        .airport-option input[type="checkbox"] {
            margin-right: 0.5rem;
        }

        /* Charts */
        .chart-container {
            height: 400px;
            margin-bottom: 2rem;
        }

        /* Status Messages */
        .status-message {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-success {
            background: rgba(76, 175, 80, 0.1);
            color: var(--success-color);
            border: 1px solid var(--success-color);
        }

        .status-error {
            background: rgba(244, 67, 54, 0.1);
            color: var(--danger-color);
            border: 1px solid var(--danger-color);
        }

        .status-warning {
            background: rgba(255, 193, 7, 0.1);
            color: var(--warning-color);
            border: 1px solid var(--warning-color);
        }

        /* Loading States */
        .loading {
            text-align: center;
            padding: 3rem;
            color: var(--text-color);
        }

        .spinner {
            border: 3px solid var(--medium-gray);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        .empty-state svg {
            width: 64px;
            height: 64px;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        /* Notification Toast */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1001;
            max-width: 400px;
        }

        .notification {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            padding: 1rem 1.5rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            animation: slideIn 0.3s ease-out;
            position: relative;
            overflow: hidden;
        }

        .notification::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
        }

        .notification.success::before {
            background: var(--success-color);
        }

        .notification.error::before {
            background: var(--danger-color);
        }

        .notification.warning::before {
            background: var(--warning-color);
        }

        .notification.info::before {
            background: var(--primary-color);
        }

        .notification-icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .notification-message {
            flex: 1;
            font-size: 0.95rem;
            color: var(--dark-gray);
        }

        .notification-close {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.25rem;
            color: #999;
            font-size: 1.2rem;
            line-height: 1;
            transition: color 0.2s ease;
        }

        .notification-close:hover {
            color: var(--dark-gray);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
                transform: translateY(0);
            }
            to {
                opacity: 0;
                transform: translateY(-10px);
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div>
                    <div class="logo">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M21,16v-2l-8-5V3.5c0-0.83-0.67-1.5-1.5-1.5S10,2.67,10,3.5V9l-8,5v2l8-2.5V19l-2,1.5V22l3.5-1l3.5,1v-1.5L13,19v-5.5L21,16z"/>
                        </svg>
                        FlightDealz
                    </div>
                    <div class="tagline">Find amazing weekend flight deals automatically</div>
                </div>
            </div>
        </div>
    </header>

    <nav>
        <div class="container">
            <div class="nav-content">
                <button class="nav-item active" data-section="deals">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z"/>
                    </svg>
                    Deals
                </button>
                <button class="nav-item" data-section="search">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                    </svg>
                    Search
                </button>
                <button class="nav-item" data-section="settings">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
                    </svg>
                    Settings
                </button>
                <button class="nav-item" data-section="history">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"/>
                    </svg>
                    History
                </button>
            </div>
        </div>
    </nav>

    <main>
        <div class="container">
            <!-- Deals Section -->
            <section id="deals-section" class="section active">
                <div class="card">
                    <div class="card-header">
                        <h2>Current Flight Deals</h2>
                        <button class="btn btn-primary" id="refresh-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                            </svg>
                            Refresh Deals
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="filter-section">
                            <div class="filter-group">
                                <label for="sort-select">Sort by:</label>
                                <select id="sort-select" class="form-control" style="width: auto;">
                                    <option value="dealScore">Best Deal</option>
                                    <option value="price">Price (Low to High)</option>
                                    <option value="departDate">Departure Date</option>
                                    <option value="destination">Destination</option>
                                </select>
                            </div>
                            <button class="btn btn-secondary" id="filter-btn">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M10 18h4v-2h-4v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/>
                                </svg>
                                Filter
                            </button>
                        </div>
                        <div id="deals-container" class="deals-container">
                            <div class="loading">
                                <div class="spinner"></div>
                                <p>Loading deals...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Search Section -->
            <section id="search-section" class="section">
                <div class="card">
                    <div class="card-header">
                        <h2>Search Flights</h2>
                    </div>
                    <div class="card-body">
                        <form id="search-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="search-from">From</label>
                                    <div class="autocomplete-wrapper">
                                        <input type="text" id="search-from" class="form-control airport-autocomplete" placeholder="Search airport or enter code" required>
                                        <div class="autocomplete-suggestions" id="search-from-suggestions"></div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="search-to">To</label>
                                    <div class="autocomplete-wrapper">
                                        <input type="text" id="search-to" class="form-control airport-autocomplete" placeholder="Search airport or enter code" required>
                                        <div class="autocomplete-suggestions" id="search-to-suggestions"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="search-depart">Departure Date</label>
                                    <input type="date" id="search-depart" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label for="search-return">Return Date</label>
                                    <input type="date" id="search-return" class="form-control" required>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary btn-block">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                                </svg>
                                Search Flights
                            </button>
                        </form>
                        <div id="search-results" class="deals-container" style="margin-top: 2rem;">
                            <!-- Search results will appear here -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section id="settings-section" class="section">
                <div class="card">
                    <div class="card-header">
                        <h2>Settings</h2>
                        <button class="btn btn-primary" id="save-settings-btn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
                            </svg>
                            Save Settings
                        </button>
                    </div>
                    <div class="card-body">
                        <form id="settings-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="base-airport">Home Airport</label>
                                    <div class="autocomplete-wrapper">
                                        <input type="text" id="base-airport" class="form-control airport-autocomplete" placeholder="Search airport or enter code" required>
                                        <div class="autocomplete-suggestions" id="base-airport-suggestions"></div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="max-price">Maximum Price ($)</label>
                                    <input type="number" id="max-price" class="form-control" min="50" step="10" placeholder="300" required>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>Destinations</label>
                                <div style="margin-bottom: 1rem;">
                                    <div class="autocomplete-wrapper">
                                        <input type="text" id="destination-search" class="form-control airport-autocomplete" placeholder="Search and add destination airport">
                                        <div class="autocomplete-suggestions" id="destination-search-suggestions"></div>
                                    </div>
                                    <button type="button" id="add-destination-btn" class="btn btn-secondary" style="margin-top: 0.5rem;">Add Destination</button>
                                </div>
                                <div style="margin-bottom: 1rem;">
                                    <label style="font-size: 0.9rem; color: #666;">Quick add popular destinations:</label>
                                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.5rem;">
                                        <button type="button" class="btn btn-secondary" style="font-size: 0.85rem; padding: 0.4rem 0.8rem;" onclick="addQuickDestination('NYC')">New York (NYC)</button>
                                        <button type="button" class="btn btn-secondary" style="font-size: 0.85rem; padding: 0.4rem 0.8rem;" onclick="addQuickDestination('LHR')">London (LHR)</button>
                                        <button type="button" class="btn btn-secondary" style="font-size: 0.85rem; padding: 0.4rem 0.8rem;" onclick="addQuickDestination('CDG')">Paris (CDG)</button>
                                        <button type="button" class="btn btn-secondary" style="font-size: 0.85rem; padding: 0.4rem 0.8rem;" onclick="addQuickDestination('HND')">Tokyo (HND)</button>
                                        <button type="button" class="btn btn-secondary" style="font-size: 0.85rem; padding: 0.4rem 0.8rem;" onclick="addQuickDestination('BKK')">Bangkok (BKK)</button>
                                    </div>
                                </div>
                                <div class="airport-select" id="destinations-select">
                                    <div class="airport-option">
                                        <input type="checkbox" id="dest-JFK" value="JFK" checked>
                                        <label for="dest-JFK">New York (JFK)</label>
                                    </div>
                                    <div class="airport-option">
                                        <input type="checkbox" id="dest-MIA" value="MIA" checked>
                                        <label for="dest-MIA">Miami (MIA)</label>
                                    </div>
                                    <div class="airport-option">
                                        <input type="checkbox" id="dest-ORD" value="ORD" checked>
                                        <label for="dest-ORD">Chicago (ORD)</label>
                                    </div>
                                    <div class="airport-option">
                                        <input type="checkbox" id="dest-BOS" value="BOS" checked>
                                        <label for="dest-BOS">Boston (BOS)</label>
                                    </div>
                                    <div class="airport-option">
                                        <input type="checkbox" id="dest-SEA" value="SEA" checked>
                                        <label for="dest-SEA">Seattle (SEA)</label>
                                    </div>
                                    <div class="airport-option">
                                        <input type="checkbox" id="dest-SFO" value="SFO" checked>
                                        <label for="dest-SFO">San Francisco (SFO)</label>
                                    </div>
                                    <div class="airport-option">
                                        <input type="checkbox" id="dest-LAS" value="LAS" checked>
                                        <label for="dest-LAS">Las Vegas (LAS)</label>
                                    </div>
                                    <div class="airport-option">
                                        <input type="checkbox" id="dest-DEN" value="DEN">
                                        <label for="dest-DEN">Denver (DEN)</label>
                                    </div>
                                    <div class="airport-option">
                                        <input type="checkbox" id="dest-PHX" value="PHX">
                                        <label for="dest-PHX">Phoenix (PHX)</label>
                                    </div>
                                    <div class="airport-option">
                                        <input type="checkbox" id="dest-ATL" value="ATL">
                                        <label for="dest-ATL">Atlanta (ATL)</label>
                                    </div>
                                </div>
                            </div>
 
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="max-flight-time">Max Flight Duration (hours)</label>
                                    <input type="number" id="max-flight-time" class="form-control" min="1" max="24" placeholder="5" required>
                                </div>
                                <div class="form-group">
                                    <label for="look-ahead-weeks">Search Period (weeks ahead)</label>
                                    <input type="number" id="look-ahead-weeks" class="form-control" min="1" max="52" placeholder="12" required>
                                </div>
                            </div>
 
                            <h3 class="mb-3">Email Notifications</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="email">Email Address</label>
                                    <input type="email" id="email" class="form-control" placeholder="your-email@example.com">
                                </div>
                                <div class="form-group">
                                    <label for="deal-threshold">Deal Alert Threshold</label>
                                    <select id="deal-threshold" class="form-control">
                                        <option value="0.9">10% below average</option>
                                        <option value="0.8">20% below average</option>
                                        <option value="0.7" selected>30% below average</option>
                                        <option value="0.6">40% below average</option>
                                        <option value="0.5">50% below average</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="email-enabled" checked>
                                    Enable email notifications
                                </label>
                            </div>
                        </form>
                    </div>
                </div>
            </section>
 
            <!-- History Section -->
            <section id="history-section" class="section">
                <div class="card">
                    <div class="card-header">
                        <h2>Price History</h2>
                        <select id="route-select" class="form-control" style="width: auto;">
                            <option value="">Select a route...</option>
                        </select>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="price-chart"></canvas>
                        </div>
                        <div id="history-table-container">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Route</th>
                                        <th>Average Price</th>
                                        <th>Lowest Price</th>
                                        <th>Highest Price</th>
                                        <th>Trend</th>
                                    </tr>
                                </thead>
                                <tbody id="history-table-body">
                                    <!-- Price history data will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>
 
    <!-- Filter Modal -->
    <div id="filter-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Filter Deals</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="filter-form">
                <div class="form-group">
                    <label for="filter-max-price">Maximum Price ($)</label>
                    <input type="number" id="filter-max-price" class="form-control" min="50" step="10">
                </div>
                <div class="form-group">
                    <label>Destinations</label>
                    <div class="airport-select" id="filter-destinations">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="filter-date-from">From Date</label>
                        <input type="date" id="filter-date-from" class="form-control">
                    </div>
                    <div class="form-group">
                        <label for="filter-date-to">To Date</label>
                        <input type="date" id="filter-date-to" class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary btn-block">Apply Filters</button>
                    <button type="button" id="reset-filters" class="btn btn-secondary btn-block">Reset Filters</button>
                </div>
            </form>
        </div>
    </div>
 
    <!-- Notification Container -->
    <div id="notification-container" class="notification-container"></div>
 
    <!-- Chart.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    
    <!-- Include the airport data FIRST -->
    <script src="airportData.js"></script>
    
    <!-- Main application script -->
    <script>
        // Global state
        let currentDeals = [];
        let filteredDeals = [];
        let settings = {};
        let priceHistory = {};
        let priceChart = null;
        let airports = [];
 
        // Clean up the airport data if needed
        function cleanAirportData(data) {
            return data.map(airport => {
                // Clean up country names (remove numeric prefixes)
                let country = airport.country || "Unknown";
                country = country.replace(/^\d+\s*/, ''); // Remove leading numbers and spaces
                
                return {
                    code: airport.code || "",
                    name: airport.name || "",
                    city: airport.city || "",
                    country: country
                };
            }).filter(airport => airport.code); // Remove entries without airport codes
        }
 
        // Function to search airports (used by autocomplete)
        function searchAirports(query) {
            if (!query || query.length < 2) return [];
            
            const searchTerm = query.toLowerCase();
            
            return airports.filter(airport => 
                airport.code.toLowerCase().includes(searchTerm) ||
                airport.name.toLowerCase().includes(searchTerm) ||
                airport.city.toLowerCase().includes(searchTerm) ||
                airport.country.toLowerCase().includes(searchTerm)
            ).slice(0, 10); // Limit results
        }
 
        // API endpoints
        const API_BASE = window.location.origin;
        const API_ENDPOINTS = {
            deals: '/api/deals',
            search: '/api/search',
            settings: '/api/settings',
            priceHistory: '/api/price-history',
            refresh: '/api/refresh',
            airports: '/api/airports'
        };
 
        // Initialize the application
        async function init() {
            // Load and clean airport data
            if (window.AIRPORT_DATA) {
                airports = cleanAirportData(window.AIRPORT_DATA);
                console.log(`Loaded and cleaned ${airports.length} airports`);
            } else {
                console.error('Airport data not found');
                airports = [];
            }
 
            // Continue with the rest of initialization
            setupEventListeners();
            setupAutocomplete();
            await loadSettings();
            await loadDeals();
            await loadPriceHistory();
        }
 
        // Event listeners
        function setupEventListeners() {
            // Navigation
            document.querySelectorAll('.nav-item').forEach(button => {
                button.addEventListener('click', (e) => switchSection(e.target.closest('.nav-item')));
            });
 
            // Deals section
            document.getElementById('refresh-btn').addEventListener('click', refreshDeals);
            document.getElementById('sort-select').addEventListener('change', sortDeals);
            document.getElementById('filter-btn').addEventListener('click', showFilterModal);
 
            // Search section
            document.getElementById('search-form').addEventListener('submit', searchFlights);
 
            // Settings section
            document.getElementById('save-settings-btn').addEventListener('click', saveSettings);
            document.getElementById('add-destination-btn').addEventListener('click', addDestination);
 
            // History section
            document.getElementById('route-select').addEventListener('change', updatePriceChart);
 
            // Filter modal
            document.querySelector('.modal-close').addEventListener('click', hideFilterModal);
            document.getElementById('filter-form').addEventListener('submit', applyFilters);
            document.getElementById('reset-filters').addEventListener('click', resetFilters);
            window.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    hideFilterModal();
                }
            });
        }
 
        // Section switching
        function switchSection(navItem) {
            const section = navItem.dataset.section;
            
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            navItem.classList.add('active');
 
            // Update sections
            document.querySelectorAll('.section').forEach(sec => {
                sec.classList.remove('active');
            });
            document.getElementById(`${section}-section`).classList.add('active');
 
            // Special handling for history section
            if (section === 'history' && priceChart) {
                priceChart.resize();
            }
        }
 
        // Load settings
        async function loadSettings() {
            try {
                const response = await fetch(API_ENDPOINTS.settings);
                settings = await response.json();
                populateSettingsForm();
            } catch (error) {
                console.error('Error loading settings:', error);
                showNotification('Failed to load settings', 'error');
            }
        }
 
        // Populate settings form
        function populateSettingsForm() {
            document.getElementById('base-airport').value = settings.baseAirport || '';
            document.getElementById('max-price').value = settings.maxPrice || 300;
            document.getElementById('max-flight-time').value = settings.maxFlightTime || 5;
            document.getElementById('look-ahead-weeks').value = settings.lookAheadWeeks || 12;
            document.getElementById('email').value = settings.email || '';
            document.getElementById('email-enabled').checked = settings.emailEnabled || false;
            document.getElementById('deal-threshold').value = settings.dealThreshold || '0.7';
 
            // Set destinations
            document.querySelectorAll('#destinations-select input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = settings.destinations?.includes(checkbox.value) || false;
            });
            
            // Update destination checkboxes with full airport names
            updateDestinationLabels();
        }
        
        // Update destination labels with full airport names
        function updateDestinationLabels() {
            document.querySelectorAll('#destinations-select .airport-option').forEach(option => {
                const checkbox = option.querySelector('input[type="checkbox"]');
                const label = option.querySelector('label');
                if (checkbox && label) {
                    const airport = airports.find(a => a.code === checkbox.value);
                    if (airport) {
                        label.textContent = `${airport.city} (${airport.code})`;
                    }
                }
            });
        }

        function createFlightCard(flight) {
            return `
                <div class="flight-card">
                    <div class="flight-header">
                        <h3>${flight.from} → ${flight.to}</h3>
                        <span class="price">$${flight.price}</span>
                    </div>
                    <div class="flight-details">
                        <p><strong>Airline:</strong> ${flight.airline} (${flight.flight})</p>
                        <p><strong>Depart:</strong> ${flight.departDate} at ${flight.departTime}</p>
                        <p><strong>Return:</strong> ${flight.returnDate} at ${flight.returnTime}</p>
                        <p><strong>Duration:</strong> ${Math.floor(flight.duration / 60)}h ${flight.duration % 60}m</p>
                    </div>
                    <div class="flight-actions">
                        <a href="${flight.url}" class="book-button" target="_blank">Book This Flight</a>
                    </div>
                </div>
            `;
        }
 
        // Add destination functionality
        function addDestination() {
            const destinationInput = document.getElementById('destination-search');
            const code = destinationInput.value.trim().toUpperCase();
            
            if (!code) {
                showNotification('Please select an airport', 'error');
                return;
            }
            
            // Validate airport code
            const airport = airports.find(a => a.code === code);
            if (!airport) {
                showNotification('Invalid airport code', 'error');
                return;
            }
            
            // Check if already exists
            const existingCheckbox = document.querySelector(`#destinations-select input[value="${code}"]`);
            if (existingCheckbox) {
                showNotification('This destination is already in your list', 'warning');
                existingCheckbox.checked = true;
                destinationInput.value = '';
                return;
            }
            
            // Add new destination
            const destinationsSelect = document.getElementById('destinations-select');
            const newOption = document.createElement('div');
            newOption.className = 'airport-option';
            newOption.innerHTML = `
                <input type="checkbox" id="dest-${code}" value="${code}" checked>
                <label for="dest-${code}">${airport.city} (${code})</label>
            `;
            destinationsSelect.appendChild(newOption);
            
            destinationInput.value = '';
            showNotification(`Added ${airport.city} (${code}) to destinations`, 'success');
        }
 
        // Save settings
        async function saveSettings() {
            const baseAirportValue = document.getElementById('base-airport').value.trim().toUpperCase();
            
            // Validate base airport
            if (!baseAirportValue) {
                showNotification('Please enter your home airport', 'error');
                return;
            }
            
            const baseAirport = airports.find(a => a.code === baseAirportValue);
            if (!baseAirport) {
                showNotification('Invalid home airport code', 'error');
                return;
            }
            
            const destinations = Array.from(document.querySelectorAll('#destinations-select input[type="checkbox"]:checked'))
                .map(checkbox => checkbox.value);
                
            if (destinations.length === 0) {
                showNotification('Please select at least one destination', 'error');
                return;
            }
 
            const newSettings = {
                baseAirport: baseAirportValue,
                maxPrice: parseInt(document.getElementById('max-price').value),
                maxFlightTime: parseInt(document.getElementById('max-flight-time').value),
                lookAheadWeeks: parseInt(document.getElementById('look-ahead-weeks').value),
                destinations: destinations,
                email: document.getElementById('email').value,
                emailEnabled: document.getElementById('email-enabled').checked,
                dealThreshold: parseFloat(document.getElementById('deal-threshold').value)
            };
 
            try {
                const response = await fetch(API_ENDPOINTS.settings, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(newSettings)
                });
 
                if (response.ok) {
                    settings = newSettings;
                    showNotification('Settings saved successfully!', 'success');
                } else {
                    throw new Error('Failed to save settings');
                }
            } catch (error) {
                console.error('Error saving settings:', error);
                showNotification('Failed to save settings', 'error');
            }
        }
 
        // Load deals
        async function loadDeals() {
            try {
                showLoading('deals-container');
                const response = await fetch(API_ENDPOINTS.deals);
                currentDeals = await response.json();
                filteredDeals = [...currentDeals];
                displayDeals(filteredDeals);
            } catch (error) {
                console.error('Error loading deals:', error);
                showNotification('Failed to load deals', 'error');
                showEmptyState('deals-container', 'No deals available');
            }
        }
 
        // Display deals
        function displayDeals(deals) {
            const container = document.getElementById('deals-container');
            
            if (!deals || deals.length === 0) {
                showEmptyState('deals-container', 'No deals found. Try adjusting your filters or check back later.');
                return;
            }
 
            container.innerHTML = deals.map(deal => createDealCard(deal)).join('');
        }
 
        // Create deal card HTML
        function createDealCard(deal) {
            const savingsPercent = Math.round(deal.dealScore * 100);
            const durationHours = Math.floor(deal.duration / 60);
            const durationMinutes = deal.duration % 60;
 
            return `
                <div class="deal-card">
                    <div class="deal-header">
                        <div class="deal-route">${deal.from} → ${deal.to}</div>
                        <div class="deal-dates">${formatDate(deal.departDate)} - ${formatDate(deal.returnDate)}</div>
                    </div>
                    <div class="deal-body">
                        <div class="deal-price">${deal.price}</div>
                        <div class="deal-savings">${savingsPercent}% below average</div>
                        <div class="deal-details">
                            <div class="deal-detail">
                                <span>Airline</span>
                                <span>${deal.airline}</span>
                            </div>
                            <div class="deal-detail">
                                <span>Flight</span>
                                <span>${deal.flight}</span>
                            </div>
                            <div class="deal-detail">
                                <span>Departure</span>
                                <span>${formatTime(deal.departTime)}</span>
                            </div>
                            <div class="deal-detail">
                                <span>Return</span>
                                <span>${formatTime(deal.returnTime)}</span>
                            </div>
                            <div class="deal-detail">
                                <span>Duration</span>
                                <span>${durationHours}h ${durationMinutes}m</span>
                            </div>
                        </div>
                        <a href="${deal.url}" target="_blank" class="btn btn-primary btn-block">
                            Book This Flight
                        </a>
                    </div>
                </div>
            `;
        }
 
        // Refresh deals
        async function refreshDeals() {
            const button = document.getElementById('refresh-btn');
            const originalContent = button.innerHTML;
            
            try {
                button.innerHTML = '<div class="spinner" style="width: 20px; height: 20px; margin: 0;"></div> Refreshing...';
                button.disabled = true;
 
                const response = await fetch(API_ENDPOINTS.refresh, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(settings)
                });
 
                if (response.ok) {
                    const result = await response.json();
                    currentDeals = result.deals;
                    filteredDeals = [...currentDeals];
                    displayDeals(filteredDeals);
                    showNotification('Deals refreshed successfully!', 'success');
                } else {
                    throw new Error('Failed to refresh deals');
                }
            } catch (error) {
                console.error('Error refreshing deals:', error);
                showNotification('Failed to refresh deals', 'error');
            } finally {
                button.innerHTML = originalContent;
                button.disabled = false;
            }
        }
 
        // Sort deals
        function sortDeals() {
            const sortBy = document.getElementById('sort-select').value;
            
            filteredDeals.sort((a, b) => {
                switch (sortBy) {
                    case 'price':
                        return a.price - b.price;
                    case 'departDate':
                        return new Date(a.departDate) - new Date(b.departDate);
                    case 'destination':
                        return a.to.localeCompare(b.to);
                    case 'dealScore':
                    default:
                        return b.dealScore - a.dealScore;
                }
            });
 
            displayDeals(filteredDeals);
        }
 
        // Filter functionality
        function showFilterModal() {
            const modal = document.getElementById('filter-modal');
            modal.classList.add('active');
            
            // Populate filter destinations with full airport names
            const filterDestinations = document.getElementById('filter-destinations');
            filterDestinations.innerHTML = settings.destinations.map(dest => {
                const airport = airports.find(a => a.code === dest);
                const displayName = airport ? `${airport.city} (${dest})` : dest;
                return `
                    <div class="airport-option">
                        <input type="checkbox" id="filter-dest-${dest}" value="${dest}" checked>
                        <label for="filter-dest-${dest}">${displayName}</label>
                    </div>
                `;
            }).join('');
        }
 
        function hideFilterModal() {
            document.getElementById('filter-modal').classList.remove('active');
        }
 
        function applyFilters(e) {
            e.preventDefault();
            
            const maxPrice = parseInt(document.getElementById('filter-max-price').value) || Infinity;
            const selectedDests = Array.from(document.querySelectorAll('#filter-destinations input:checked'))
                .map(cb => cb.value);
            const fromDate = document.getElementById('filter-date-from').value;
            const toDate = document.getElementById('filter-date-to').value;
 
            filteredDeals = currentDeals.filter(deal => {
                const priceOk = deal.price <= maxPrice;
                const destOk = selectedDests.includes(deal.to);
                const fromDateOk = !fromDate || deal.departDate >= fromDate;
                const toDateOk = !toDate || deal.departDate <= toDate;
                
                return priceOk && destOk && fromDateOk && toDateOk;
            });
 
            displayDeals(filteredDeals);
            hideFilterModal();
            showNotification(`Found ${filteredDeals.length} deals matching your filters`, 'success');
        }
 
        function resetFilters() {
            document.getElementById('filter-form').reset();
            filteredDeals = [...currentDeals];
            displayDeals(filteredDeals);
            showNotification('Filters reset', 'success');
        }
 
        // Search flights
        async function searchFlights(e) {
            e.preventDefault();
            
            const fromValue = document.getElementById('search-from').value.trim().toUpperCase();
            const toValue = document.getElementById('search-to').value.trim().toUpperCase();
            
            // Validate airports
            const fromAirport = airports.find(a => a.code === fromValue);
            const toAirport = airports.find(a => a.code === toValue);
            
            if (!fromAirport) {
                showNotification('Invalid departure airport', 'error');
                return;
            }
            
            if (!toAirport) {
                showNotification('Invalid destination airport', 'error');
                return;
            }
            
            const searchData = {
                from: fromValue,
                to: toValue,
                departDate: document.getElementById('search-depart').value,
                returnDate: document.getElementById('search-return').value
            };
 
            try {
                showLoading('search-results');
                
                const response = await fetch(API_ENDPOINTS.search, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(searchData)
                });
 
                if (response.ok) {
                    const results = await response.json();
                    displaySearchResults(results);
                } else {
                    throw new Error('Search failed');
                }
            } catch (error) {
                console.error('Error searching flights:', error);
                showNotification('Search failed. Please try again.', 'error');
                showEmptyState('search-results', 'Search failed');
            }
        }
 
        function displaySearchResults(results) {
            const container = document.getElementById('search-results');
            
            if (!results || results.length === 0) {
                showEmptyState('search-results', 'No flights found for your search criteria.');
                return;
            }
 
            container.innerHTML = results.map(flight => createDealCard(flight)).join('');
        }
 
        // Price history
        async function loadPriceHistory() {
            try {
                const response = await fetch(API_ENDPOINTS.priceHistory);
                priceHistory = await response.json();
                populatePriceHistory();
            } catch (error) {
                console.error('Error loading price history:', error);
                showNotification('Failed to load price history', 'error');
            }
        }
 
        function populatePriceHistory() {
            // Populate route select
            const routeSelect = document.getElementById('route-select');
            const routes = Object.keys(priceHistory);
            
            routeSelect.innerHTML = '<option value="">Select a route...</option>' +
                routes.map(route => `<option value="${route}">${route}</option>`).join('');
 
            // Populate history table
            const tbody = document.getElementById('history-table-body');
            tbody.innerHTML = routes.map(route => {
                const data = priceHistory[route];
                return `
                    <tr>
                        <td>${route}</td>
                        <td>${Math.round(data.average)}</td>
                        <td>${Math.min(...data.prices)}</td>
                        <td>${Math.max(...data.prices)}</td>
                        <td>${getTrend(data.prices)}</td>
                    </tr>
                `;
            }).join('');
        }
 
        function getTrend(prices) {
            if (prices.length < 3) return 'Insufficient data';
            
            const recent = prices.slice(-3);
            const oldAvg = recent.slice(0, 2).reduce((a, b) => a + b, 0) / 2;
            const current = recent[2];
            
            if (current < oldAvg * 0.95) return '↓ Decreasing';
            if (current > oldAvg * 1.05) return '↑ Increasing';
            return '→ Stable';
        }
 
        function updatePriceChart() {
            const route = document.getElementById('route-select').value;
            if (!route || !priceHistory[route]) return;
 
            const data = priceHistory[route];
            const ctx = document.getElementById('price-chart').getContext('2d');
 
            if (priceChart) {
                priceChart.destroy();
            }
 
            priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.prices.map((_, i) => `Week ${i + 1}`),
                    datasets: [{
                        label: 'Price',
                        data: data.prices,
                        borderColor: '#0066FF',
                        backgroundColor: 'rgba(0, 102, 255, 0.1)',
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'Average',
                        data: new Array(data.prices.length).fill(data.average),
                        borderColor: '#FF4081',
                        borderDash: [5, 5],
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        },
                        title: {
                            display: true,
                            text: `Price History: ${route}`
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'Price ($)'
                            }
                        }
                    }
                }
            });
        }
 
        // Utility functions
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }
 
        function formatTime(timeString) {
            const [hours, minutes] = timeString.split(':');
            const date = new Date();
            date.setHours(parseInt(hours), parseInt(minutes));
            return date.toLocaleTime
            return date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
       }

       function showLoading(containerId) {
           const container = document.getElementById(containerId);
           container.innerHTML = `
               <div class="loading">
                   <div class="spinner"></div>
                   <p>Loading...</p>
               </div>
           `;
       }

       function showEmptyState(containerId, message) {
           const container = document.getElementById(containerId);
           container.innerHTML = `
               <div class="empty-state">
                   <svg viewBox="0 0 24 24" fill="currentColor">
                       <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14H7v-2h5v2zm5-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                   </svg>
                   <p>${message}</p>
               </div>
           `;
       }

       function showNotification(message, type = 'success') {
           const container = document.getElementById('notification-container');
           
           // Create notification element
           const notification = document.createElement('div');
           notification.className = `notification ${type}`;
           
           // Icons for different types
           const icons = {
               success: '<svg viewBox="0 0 24 24" fill="currentColor" style="color: #4CAF50;"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>',
               error: '<svg viewBox="0 0 24 24" fill="currentColor" style="color: #F44336;"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>',
               warning: '<svg viewBox="0 0 24 24" fill="currentColor" style="color: #FFC107;"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg>',
               info: '<svg viewBox="0 0 24 24" fill="currentColor" style="color: #0066FF;"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>'
           };
           
           notification.innerHTML = `
               <div class="notification-icon">${icons[type] || icons.info}</div>
               <div class="notification-message">${message}</div>
               <button class="notification-close">&times;</button>
           `;
           
           // Add close button functionality
           notification.querySelector('.notification-close').addEventListener('click', () => {
               removeNotification(notification);
           });
           
           // Add to container
           container.appendChild(notification);
           
           // Auto remove after 5 seconds
           setTimeout(() => {
               removeNotification(notification);
           }, 5000);
       }
       
       function removeNotification(notification) {
           notification.style.animation = 'fadeOut 0.3s ease-out';
           notification.addEventListener('animationend', () => {
               if (notification.parentNode) {
                   notification.parentNode.removeChild(notification);
               }
           });
       }

       // Autocomplete functionality
       function setupAutocomplete() {
           const autocompleteInputs = document.querySelectorAll('.airport-autocomplete');
           
           autocompleteInputs.forEach(input => {
               const suggestionBox = document.getElementById(`${input.id}-suggestions`);
               let selectedIndex = -1;
               
               // Input event for searching airports
               input.addEventListener('input', (e) => {
                   const query = e.target.value.toLowerCase().trim();
                   
                   if (query.length < 2) {
                       suggestionBox.classList.remove('active');
                       return;
                   }
                   
                   const matches = searchAirports(query);
                   
                   if (matches.length > 0) {
                       renderSuggestions(matches, suggestionBox, input);
                       suggestionBox.classList.add('active');
                       selectedIndex = -1;
                   } else {
                       suggestionBox.classList.remove('active');
                   }
               });
               
               // Keyboard navigation
               input.addEventListener('keydown', (e) => {
                   const suggestions = suggestionBox.querySelectorAll('.autocomplete-suggestion');
                   
                   if (!suggestionBox.classList.contains('active')) return;
                   
                   switch(e.key) {
                       case 'ArrowDown':
                           e.preventDefault();
                           selectedIndex = Math.min(selectedIndex + 1, suggestions.length - 1);
                           updateSelection(suggestions, selectedIndex);
                           break;
                       case 'ArrowUp':
                           e.preventDefault();
                           selectedIndex = Math.max(selectedIndex - 1, -1);
                           updateSelection(suggestions, selectedIndex);
                           break;
                       case 'Enter':
                           e.preventDefault();
                           if (selectedIndex >= 0 && suggestions[selectedIndex]) {
                               selectAirport(suggestions[selectedIndex].dataset.code, input, suggestionBox);
                           }
                           break;
                       case 'Escape':
                           suggestionBox.classList.remove('active');
                           selectedIndex = -1;
                           break;
                   }
               });
               
               // Click outside to close
               document.addEventListener('click', (e) => {
                   if (!input.contains(e.target) && !suggestionBox.contains(e.target)) {
                       suggestionBox.classList.remove('active');
                       selectedIndex = -1;
                   }
               });
               
               // Focus event to show suggestions if input has value
               input.addEventListener('focus', (e) => {
                   if (e.target.value.length >= 2) {
                       const inputEvent = new Event('input', { bubbles: true });
                       input.dispatchEvent(inputEvent);
                   }
               });
           });
       }
       
       function renderSuggestions(matches, suggestionBox, input) {
           suggestionBox.innerHTML = matches.map((airport, index) => `
               <div class="autocomplete-suggestion" data-code="${airport.code}" data-index="${index}">
                   <div class="autocomplete-suggestion-main">
                       <div class="autocomplete-suggestion-name">${airport.name}</div>
                       <div class="autocomplete-suggestion-city">${airport.city}, ${airport.country}</div>
                   </div>
                   <div class="autocomplete-suggestion-code">${airport.code}</div>
               </div>
           `).join('');
           
           // Add click handlers
           suggestionBox.querySelectorAll('.autocomplete-suggestion').forEach(suggestion => {
               suggestion.addEventListener('click', () => {
                   selectAirport(suggestion.dataset.code, input, suggestionBox);
               });
           });
       }
       
       function updateSelection(suggestions, selectedIndex) {
           suggestions.forEach((suggestion, index) => {
               if (index === selectedIndex) {
                   suggestion.classList.add('selected');
                   suggestion.scrollIntoView({ block: 'nearest' });
               } else {
                   suggestion.classList.remove('selected');
               }
           });
       }
       
       function selectAirport(code, input, suggestionBox) {
           input.value = code;
           suggestionBox.classList.remove('active');
           
           // Trigger change event
           const changeEvent = new Event('change', { bubbles: true });
           input.dispatchEvent(changeEvent);
           
           // Move focus to next input if available
           const form = input.closest('form');
           if (form) {
               const inputs = Array.from(form.querySelectorAll('input'));
               const currentIndex = inputs.indexOf(input);
               if (currentIndex < inputs.length - 1) {
                   inputs[currentIndex + 1].focus();
               }
           }
       }

       // Quick add destination function
       window.addQuickDestination = function(code) {
           document.getElementById('destination-search').value = code;
           addDestination();
       };

       // Initialize the app when DOM is loaded
       document.addEventListener('DOMContentLoaded', init);
   </script>
</body>
</html>